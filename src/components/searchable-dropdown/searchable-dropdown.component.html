<div class="dropdown-container" #dropdownContainer>
  <label [for]="id" class="dropdown-label">{{ label() }}</label>

  <button
    type="button"
    [id]="id"
    (click)="toggleDropdown()"
    class="dropdown-button"
    [disabled]="disabled()"
    [attr.aria-expanded]="isOpen()"
    aria-haspopup="listbox">

    <span class="dropdown-selected">
      {{ selectedOption()?.name || placeholder() }}
    </span>

    <span class="dropdown-icon">
      <svg viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd"
              d="M10 3a.75.75 0 01.53.22l3.5 3.5a.75.75 0 01-1.06 1.06L10 4.81 6.53 8.28a.75.75 0 01-1.06-1.06l3.5-3.5A.75.75 0 0110 3z"
              clip-rule="evenodd"/>
        <path fill-rule="evenodd"
              d="M10 17a.75.75 0 01-.53-.22l-3.5-3.5a.75.75 0 011.06-1.06L10 15.19l3.47-3.47a.75.75 0 011.06 1.06l-3.5 3.5A.75.75 0 0110 17z"
              clip-rule="evenodd"/>
      </svg>
    </span>
  </button>

  @if (isOpen()) {
    <div class="dropdown-menu">
      <div class="dropdown-search">
        <input
          type="text"
          #searchInput
          placeholder="Search..."
          (input)="onSearch($event)"
          class="dropdown-search-input">
      </div>

      <ul class="dropdown-options" role="listbox">
        @for (option of filteredOptions(); track option.id) {
          <li
            class="dropdown-option"
            [class.active]="selectedOption()?.id === option.id"
            (click)="selectOption(option)">
            <span>{{ option.name }}</span>

            @if (selectedOption()?.id === option.id) {
              <span class="dropdown-check">
                <svg viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                        d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.052-.143z"
                        clip-rule="evenodd"/>
                </svg>
              </span>
            }
          </li>
        } @empty {
          <li class="dropdown-no-option">No options found.</li>
        }
      </ul>
    </div>
  }
</div>
